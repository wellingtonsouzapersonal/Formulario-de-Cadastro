<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Cadastro e Anamnese</title>
    <!-- Inclui o Tailwind CSS para estilização rápida e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .form-container {
            background-color: #ffffff;
            padding: 32px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-width: 700px;
            width: 100%;
            border: 1px solid #e0e0e0;
            position: relative;
            z-index: 1;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        input[type="text"],
        input[type="email"],
        input[type="date"],
        input[type="tel"],
        input[type="number"],
        input[type="time"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            color: #555;
            transition: border-color 0.3s ease;
        }
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="date"]:focus,
        input[type="tel"]:focus,
        input[type="number"]:focus,
        input[type="time"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        .radio-group label, .checkbox-group label {
            display: inline-flex;
            align-items: center;
            margin-right: 20px;
            cursor: pointer;
            font-weight: 400;
        }
        .radio-group input[type="radio"], .checkbox-group input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
        }
        button {
            width: 100%;
            padding: 16px;
            background-color: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 10px;
        }
        button:hover {
            background-color: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
        }
        .button-highlight {
            background-color: #10B981;
        }
        .button-highlight:hover {
            background-color: #059669;
        }
        /* Classe de preço e aviso removida do uso ativo, mas mantida no CSS para estabilidade */
        .price-display { 
            background-color: #e0f2fe;
            color: #0c4a6e;
            padding: 16px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            font-weight: 600;
            font-size: 1.25rem;
            border: 1px solid #90cdf4;
        }
        .plan-details {
            background-color: #e0f2fe;
            color: #0c4a6e;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid #90cdf4;
            font-size: 0.9rem;
        }
        .plan-details ul {
            list-style: disc;
            margin-left: 20px;
        }
        .plan-details li {
            margin-bottom: 4px;
        }
        .logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 150px;
            height: auto;
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4f46e5;
            margin-top: 30px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        .hidden-group {
            display: none;
        }
        .observation-text {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 10px;
            font-style: italic;
            text-align: center;
        }
        .motivational-phrase {
            font-style: italic;
            font-weight: 500;
            text-align: center;
            margin-top: 30px;
            margin-bottom: 20px;
            color: #4a5568;
            font-size: 1rem;
        }
        .meal-details {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            margin-left: 30px;
        }
        .welcome-message {
            background-color: #d1fae5;
            color: #065f46;
            padding: 16px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
            display: none;
        }
        .review-data p {
            margin-bottom: 8px;
            font-size: 1rem;
            color: #4a5568;
        }
        .review-data strong {
            color: #2d3748;
        }
        .review-box {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        .review-box .section-title {
            margin-top: 0;
            padding-top: 0;
            border-bottom: none;
        }
        .review-box hr {
            display: none;
        }
        .parcelas-container {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <!-- Logo -->
        <div class="flex justify-center mb-6">
            <img src="https://raw.githubusercontent.com/wellingtonsouzapersonal/Formul-rio-de-Anaminese/main/WS%20LOGO%20MARCADA%CC%81GUA.png" alt="Logomarca Wellington Souza" class="logo" onerror="this.onerror=null; this.src='https://placehold.co/150x50/cccccc/333333?text=Logo+Não+Encontrada';">
        </div>
        <!-- AÇÃO DO FORMULÁRIO APONTA PARA FORMSPREE -->
        <!-- ADICIONADO novalidate para DESATIVAR a validação nativa do navegador -->
        <form id="multiStepForm" action="https://formspree.io/f/xldpvlzo" method="POST" class="space-y-6" novalidate>
            <!-- Etapa 1: Formulário de Cadastro -->
            <div id="step1">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">Formulário de Cadastro</h2>
                <div class="section-title">Informações Pessoais</div>
                <hr class="mb-6">

                <div class="form-group">
                    <label for="nomeCompleto">Nome completo:</label>
                    <input type="text" id="nomeCompleto" name="Nome Completo" required class="rounded-lg">
                </div>

                <div class="form-group flex flex-col sm:flex-row sm:space-x-4">
                    <div class="w-full sm:w-1/3 mb-4 sm:mb-0">
                        <label for="cpf">CPF:</label>
                        <input type="text" id="cpf" name="CPF" required class="rounded-lg">
                    </div>
                    <div class="w-full sm:w-1/3 mb-4 sm:mb-0">
                        <label for="dataNascimento">Data de Nascimento:</label>
                        <input type="date" id="dataNascimento" name="Data de Nascimento" required class="rounded-lg">
                    </div>
                    <div class="w-full sm:w-1/3">
                        <label for="idade">Idade:</label>
                        <input type="text" id="idade" name="Idade" readonly class="rounded-lg bg-gray-100 cursor-not-allowed">
                    </div>
                </div>

                <div class="form-group flex flex-col sm:flex-row sm:space-x-4">
                    <div class="w-full sm:w-1/2 mb-4 sm:mb-0">
                        <label for="altura">Altura (cm):</label>
                        <!-- REQUIRED REMOVIDO -->
                        <input type="number" id="altura" name="Altura" min="50" max="300" placeholder="Ex: 175" class="rounded-lg">
                    </div>
                    <div class="w-full sm:w-1/2">
                        <label for="peso">Peso (kg):</label>
                        <!-- REQUIRED REMOVIDO -->
                        <input type="number" id="peso" name="Peso" min="1" max="500" step="0.1" placeholder="Ex: 70.5" class="rounded-lg">
                    </div>
                </div>

                <div class="form-group flex flex-col sm:flex-row sm:space-x-4">
                    <div class="w-full sm:w-1/2 mb-4 sm:mb-0">
                        <label>Gênero:</label>
                        <div class="radio-group flex mt-2">
                            <label><input type="radio" name="Genero" value="Feminino" required> Feminino</label>
                            <label><input type="radio" name="Genero" value="Masculino"> Masculino</label>
                            <label><input type="radio" name="Genero" value="Prefiro não identificar"> Prefiro não identificar</label>
                        </div>
                    </div>
                    <div class="w-full sm:w-1/2">
                        <label for="profissao">Profissão:</label>
                        <input type="text" id="profissao" name="Profissão" required class="rounded-lg">
                    </div>
                </div>

                <div class="form-group flex flex-col sm:flex-row sm:space-x-4">
                    <div class="w-full sm:w-1/2 mb-4 sm:mb-0">
                        <label for="telefoneContato">Telefone de contato:</label>
                        <input type="tel" id="telefoneContato" name="Telefone de Contato" placeholder="(XX) XXXXX-XXXX" required class="rounded-lg">
                    </div>
                    <div class="w-full sm:w-1/2">
                        <label for="contatoEmergencia">Contato de Emergência:</label>
                        <input type="text" id="contatoEmergencia" name="Contato de Emergência" placeholder="Ex: Nome do Contato (XX) XXXXX-XXXX" required class="rounded-lg">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Endereço:</label>
                    <div class="flex flex-col sm:flex-row sm:space-x-4">
                        <div class="w-full sm:w-1/2 mb-4 sm:mb-0">
                            <label for="cep">CEP:</label>
                            <input type="text" id="cep" name="CEP" class="rounded-lg">
                        </div>
                        <div class="w-full sm:w-1/2 mb-4 sm:mb-0">
                            <label for="rua">Rua:</label>
                            <input type="text" id="rua" name="Rua" required class="rounded-lg">
                        </div>
                        <div class="w-full sm:w-1/2">
                            <label for="numeroCasa">Número:</label>
                            <input type="text" id="numeroCasa" name="Número da Casa" required class="rounded-lg">
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row sm:space-x-4 mt-4">
                        <div class="w-full sm:w-1/2 mb-4 sm:mb-0">
                            <label for="bairro">Bairro:</label>
                            <input type="text" id="bairro" name="Bairro" required class="rounded-lg">
                        </div>
                        <div class="w-full sm:w-1/2">
                            <label for="cidade">Cidade:</label>
                            <input type="text" id="cidade" name="Cidade" required class="rounded-lg">
                        </div>
                    </div>
                </div>

                <div class="form-group flex flex-col sm:flex-row sm:space-x-4">
                    <div class="w-full sm:w-1/2 mb-4 sm:mb-0">
                        <label for="email">E-mail:</label>
                        <input type="email" id="email" name="E-mail" required class="rounded-lg">
                    </div>
                    <div class="w-full sm:w-1/2">
                        <label for="instagram">Instagram:</label>
                        <input type="text" id="instagram" name="Instagram" placeholder="@seu_instagram" class="rounded-lg">
                    </div>
                </div>
                
                <!-- AVISO DE VALORES REMOVIDO -->
                <div class="w-full p-4 rounded-lg bg-blue-100 font-semibold text-center mt-6 border border-blue-300" style="color: #0c4a6e;">
                    PREENCHA AS INFORMAÇÕES DO PLANO DESEJADO PARA AVANÇAR NO FORMULÁRIO.
                </div>

                <!-- CAMPOS MANTIDOS: Data de Início e Planejamento Alimentar -->
                <div class="form-group flex flex-col sm:flex-row sm:space-x-4">
                    <div class="w-full sm:w-1/2 mb-4 sm:mb-0">
                        <label for="dataInicio">Data de início:</label>
                        <input type="date" id="dataInicio" name="Data de Início" required class="rounded-lg">
                    </div>
                    <div class="w-full sm:w-1/2">
                        <label>Deseja incluir planejamento alimentar?</label>
                        <div class="radio-group flex mt-2">
                            <label><input type="radio" name="Planejamento Alimentar" value="Sim" required> Sim</label>
                            <label><input type="radio" name="Planejamento Alimentar" value="Não"> Não</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Escolha o seu Plano:</label>
                    <div class="radio-group flex flex-wrap gap-4 mt-2">
                        <label><input type="radio" name="Plano Escolhido" value="Trimestral Individual" required> Trimestral Individual</label>
                        <label><input type="radio" name="Plano Escolhido" value="Trimestral Compartilhado"> Trimestral Compartilhado</label>
                        <label><input type="radio" name="Plano Escolhido" value="Semestral Individual" required> Semestral Individual</label>
                        <label><input type="radio" name="Plano Escolhido" value="Semestral Compartilhado"> Semestral Compartilhado</label>
                        <label><input type="radio" name="Plano Escolhido" value="Trimestral Casal"> Trimestral Casal</label>
                        <label><input type="radio" name="Plano Escolhido" value="Semestral Casal"> Semestral Casal</label>
                        <label><input type="radio" name="Plano Escolhido" value="Online"> Online</label>
                    </div>
                    <div id="planDetailsDisplay" class="plan-details hidden-group"></div>
                </div>

                <div class="form-group" id="frequenciaContainer">
                    <label for="frequenciaSemana">Quantas vezes por semana:</label>
                    <select id="frequenciaSemana" name="Frequência Semanal" required class="rounded-lg">
                        <option value="">Selecione uma opção</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>

                <!-- CAMPO FORMA DE PAGAMENTO REMOVIDO -->
                <input type="hidden" id="formaPagamento" name="Forma de Pagamento" value="Não Aplicável - Sem Valores">

                <!-- DISPLAY DE VALOR ESTIMADO REMOVIDO -->
                <input type="hidden" id="valorEstimadoHidden" name="Valor Estimado" value="Não Aplicável - Valores Removidos">
                
                <!-- Notificação de campos faltando REMOVIDA, pois não há mais valores -->
                <div id="planWarningMessage" class="hidden-group p-4 rounded-lg text-yellow-700 bg-yellow-100 border border-yellow-200">
                    <!-- Conteúdo removido -->
                </div>

                <p class="motivational-phrase">Mudar não é fácil, mas quando você nota os resultados, nada te faz parar.</p>

                <button id="nextButton1" type="button" class="button-highlight">Próximo</button>
            </div>
            
            <!-- Etapa 2: Formulário de Anamnese -->
            <div id="step2" class="hidden-group">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">Formulário de Anamnese</h2>

                <!-- Seção: Histórico de Aptidão Física -->
                <div class="section-title">Histórico de Aptidão Física</div>
                <hr class="mb-6">
                <div class="form-group">
                    <label>Teve alguma cirurgia nos últimos 12 meses?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="cirurgia" value="Sim" required> Sim</label>
                        <label><input type="radio" name="cirurgia" value="Não"> Não</label>
                    </div>
                    <textarea id="cirurgia-obs" name="Cirurgia Observação" class="mt-4 hidden-group rounded-lg" placeholder="Qual cirurgia e quando?"></textarea>
                </div>

                <div class="form-group">
                    <label>Possui problemas de coluna (hérnia, escoliose, etc.)?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="coluna" value="Sim" required> Sim</label>
                        <label><input type="radio" name="coluna" value="Não"> Não</label>
                    </div>
                    <textarea id="coluna-obs" name="Coluna Observação" class="mt-4 hidden-group rounded-lg" placeholder="Qual problema e qual o nível de dor?"></textarea>
                </div>

                <div class="form-group">
                    <label>Possui problemas nas articulações (joelhos, ombros, tornozelos, etc.)?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="articulacoes" value="Sim" required> Sim</label>
                        <label><input type="radio" name="articulacoes" value="Não"> Não</label>
                    </div>
                    <textarea id="articulacoes-obs" name="Articulações Observação" class="mt-4 hidden-group rounded-lg" placeholder="Quais articulações e qual o nível de dor?"></textarea>
                </div>

                <div class="form-group">
                    <label>Já teve alguma lesão muscular ou articular grave?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="lesao" value="Sim" required> Sim</label>
                        <label><input type="radio" name="lesao" value="Não"> Não</label>
                    </div>
                    <textarea id="lesao-obs" name="Lesão Observação" class="mt-4 hidden-group rounded-lg" placeholder="Qual lesão e qual o nível de dor?"></textarea>
                </div>

                <div class="form-group">
                    <label>Possui alguma restrição médica para exercícios físicos?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="restricaoMedica" value="Sim" required> Sim</label>
                        <label><input type="radio" name="restricaoMedica" value="Não"> Não</label>
                    </div>
                    <textarea id="restricaoMedica-obs" name="Restrição Médica Observação" class="mt-4 hidden-group rounded-lg" placeholder="Qual restrição e o motivo?"></textarea>
                </div>

                <!-- Seção: Hábitos de Vida e Treino -->
                <div class="section-title">Hábitos de Vida e Treino</div>
                <hr class="mb-6">
                <div class="form-group">
                    <label>Fuma?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="fuma" value="Sim" required> Sim</label>
                        <label><input type="radio" name="fuma" value="Não"> Não</label>
                    </div>
                    <div id="fuma-frequencia" class="mt-4 hidden-group">
                        <label for="fumaFrequencia">Frequência:</label>
                        <div class="radio-group flex mt-2">
                            <label><input type="radio" name="fuma-frequencia" value="Frequentemente" required> Frequentemente</label>
                            <label><input type="radio" name="fuma-frequencia" value="Socialmente"> Socialmente</label>
                            <label><input type="radio" name="fuma-frequencia" value="Raramente"> Raramente</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Ingere bebida alcoólica?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="alcool" value="Sim" required> Sim</label>
                        <label><input type="radio" name="alcool" value="Não"> Não</label>
                    </div>
                    <div id="alcool-frequencia" class="mt-4 hidden-group">
                        <label for="alcoolFrequencia">Frequência:</label>
                        <div class="radio-group flex mt-2">
                            <label><input type="radio" name="alcool-frequencia" value="Frequentemente" required> Frequentemente</label>
                            <label><input type="radio" name="alcool-frequencia" value="Socialmente"> Socialmente</label>
                            <label><input type="radio" name="alcool-frequencia" value="Raramente"> Raramente</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Pratica atividade física atualmente?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="atividadeFisica" value="Sim" required> Sim</label>
                        <label><input type="radio" name="atividadeFisica" value="Não"> Não</label>
                    </div>
                    <textarea id="atividadeFisica-obs" name="Atividade Física Observação" class="mt-4 hidden-group rounded-lg" placeholder="Qual atividade, frequência e duração?"></textarea>
                </div>

                <div class="form-group">
                    <label>Qual seu nível de experiência com musculação?</label>
                    <div class="radio-group flex flex-col sm:flex-row mt-2">
                        <label class="mb-2 sm:mb-0"><input type="radio" name="nivelMusculacao" value="Iniciante" required> Iniciante (nunca treinou ou treinou pouco)</label>
                        <label class="mb-2 sm:mb-0"><input type="radio" name="nivelMusculacao" value="Intermediario"> Intermediário (treina há algum tempo, mas sem grande regularidade/intensidade)</label>
                        <label class="mb-2 sm:mb-0"><input type="radio" name="nivelMusculacao" value="Avancado"> Avançado (treina há bastante tempo, com regularidade e intensidade)</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Já treinou com personal trainer?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="personalTrainer" value="Sim" required> Sim</label>
                        <label><input type="radio" name="personalTrainer" value="Não"> Não</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Qualidade do sono:</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="qualidadeSono" value="Boa" required> Boa</label>
                        <label><input type="radio" name="qualidadeSono" value="Regular"> Regular</label>
                        <label><input type="radio" name="qualidadeSono" value="Ruim"> Ruim</label>
                    </div>
                    <!-- NOVO CAMPO: Quantas horas de sono -->
                    <label for="horasSono" class="mt-4">Quantas horas de sono por noite (média):</label>
                    <input type="number" id="horasSono" name="Horas de Sono" min="0" max="24" step="0.5" placeholder="Ex: 7.5" required class="rounded-lg">
                </div>

                <!-- Seção: Objetivos e Expectativas -->
                <div class="section-title">Objetivos e Expectativas</div>
                <hr class="mb-6">
                <div class="form-group">
                    <label>Qual seu principal objetivo com a musculação? (Pode marcar mais de um)</label>
                    <div class="checkbox-group flex flex-wrap gap-4 mt-2">
                        <label><input type="checkbox" name="objetivo" value="Ganho de Massa Muscular"> Ganho de Massa Muscular (Hipertrofia)</label>
                        <label><input type="checkbox" name="objetivo" value="Emagrecimento / Perda de Gordura"> Emagrecimento / Perda de Gordura</label>
                        <label><input type="checkbox" name="objetivo" value="Melhora da Força"> Melhora da Força</label>
                        <label><input type="checkbox" name="objetivo" value="Melhora da Resistência"> Melhora da Resistência</label>
                        <label><input type="checkbox" name="objetivo" value="Condicionamento Físico Geral"> Condicionamento Físico Geral</label>
                        <label><input type="checkbox" name="objetivo" value="Saúde e Bem-estar"> Saúde e Bem-estar</label>
                        <label><input type="checkbox" name="objetivo" value="Reabilitação / Fortalecimento"> Reabilitação / Fortalecimento</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Qual resultado você espera alcançar e em quanto tempo (aproximadamente)?</label>
                    <textarea name="resultadoEsperado" class="rounded-lg" placeholder="Descreva aqui suas expectativas..."></textarea>
                </div>

                <div class="form-group">
                    <label>Há algo mais que você gostaria de nos informar sobre sua saúde ou objetivos?</label>
                    <textarea name="informacoesAdicionais" class="rounded-lg" placeholder="Escreva aqui..."></textarea>
                </div>

                <p class="motivational-phrase">Seu corpo é capaz de tudo, é sua mente que você precisa convencer.</p>

                <div class="flex justify-between mt-8 space-x-4">
                    <button id="backButton1" type="button" class="w-1/2 bg-gray-300 text-gray-800 font-bold hover:bg-gray-400">Voltar</button>
                    <button id="nextButton2" type="button" class="w-1/2 button-highlight">Próximo</button>
                </div>
            </div>

            <!-- Etapa 3: Formulário Nutricional (Será a nova Etapa 2.5, mas manteremos o ID 3) -->
            <div id="step3" class="hidden-group">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">Formulário Nutricional</h2>
                
                <!-- Seção: Histórico de Saúde (Nutricional) -->
                <div class="section-title">Histórico de Saúde (Nutricional)</div>
                <hr class="mb-6">
                <div class="form-group">
                    <label>Faz uso de alguma medicação contínua?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="medicacao" value="Sim" required> Sim</label>
                        <label><input type="radio" name="medicacao" value="Não"> Não</label>
                    </div>
                    <textarea id="medicacao-obs" name="Medicação contínua - Observação" class="mt-4 hidden-group rounded-lg" placeholder="Qual medicação e motivo?"></textarea>
                </div>

                <div class="form-group">
                    <label>Possui alguma doença crônica (Diabetes, Hipertensão, Cardíacas, Asma, Tireoide, etc.)?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="doencaCronica" value="Sim" required> Sim</label>
                        <label><input type="radio" name="doencaCronica" value="Não"> Não</label>
                    </div>
                    <textarea id="doencaCronica-obs" name="Doença Crônica - Observação" class="mt-4 hidden-group rounded-lg" placeholder="Qual doença?"></textarea>
                </div>

                <div class="form-group">
                    <label>Possui intolerância ou alergia alimentar?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="alergiaAlimentar" value="Sim" required> Sim</label>
                        <label><input type="radio" name="alergiaAlimentar" value="Não"> Não</label>
                    </div>
                    <textarea id="alergiaAlimentar-obs" name="Alergia Alimentar - Observação" class="mt-4 hidden-group rounded-lg" placeholder="Qual intolerância ou alergia?"></textarea>
                </div>

                <!-- Seção: Hábitos Alimentares -->
                <div class="section-title">Hábitos Alimentares</div>
                <hr class="mb-6">
                
                <!-- NOVOS CAMPOS DE PREFERÊNCIA ALIMENTAR -->
                <div class="form-group">
                    <label for="alimentosGosta">Alimentos que mais gosta (para inclusão no plano):</label>
                    <textarea id="alimentosGosta" name="Alimentos que mais gosta" class="rounded-lg" placeholder="Ex: Frango, batata-doce, brócolis, manga"></textarea>
                </div>

                <div class="form-group">
                    <label for="alimentosNaoGosta">Alimentos que NÃO gosta (para exclusão no plano):</label>
                    <textarea id="alimentosNaoGosta" name="Alimentos que NÃO gosta" class="rounded-lg" placeholder="Ex: Peixe, quiabo, pimentão"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Você pula alguma refeição principal (café da manhã, almoço, jantar)?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="pulaRefeicao" value="Sim" required> Sim</label>
                        <label><input type="radio" name="pulaRefeicao" value="Não"> Não</label>
                    </div>
                    <textarea id="pulaRefeicao-obs" name="Pula Refeição - Observação" class="mt-4 hidden-group rounded-lg" placeholder="Qual refeição?"></textarea>
                </div>

                <div class="form-group">
                    <label>Costuma ingerir frutas e vegetais diariamente?</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="frutasVegetais" value="Sim" required> Sim</label>
                        <label><input type="radio" name="frutasVegetais" value="Não"> Não</label>
                    </div>
                    <textarea id="frutasVegetais-obs" name="Frutas e Vegetais - Observação" class="mt-4 hidden-group rounded-lg" placeholder="Quais frutas/vegetais?"></textarea>
                </div>

                <div class="form-group">
                    <label for="quantidadeAgua">Quantidade de água (litros/dia):</label>
                    <input type="number" id="quantidadeAgua" name="Quantidade de Água" min="0" step="0.1" placeholder="Ex: 2.5" required class="rounded-lg">
                </div>

                <div class="form-group">
                    <label>Consumo de fast food, doces e ultraprocessados:</label>
                    <div class="radio-group flex mt-2">
                        <label><input type="radio" name="consumoFastFood" value="Muito Frequente" required> Muito Frequente</label>
                        <label><input type="radio" name="consumoFastFood" value="Ocasional"> Ocasional</label>
                        <label><input type="radio" name="consumoFastFood" value="Raramente"> Raramente</label>
                    </div>
                    <textarea id="consumoFastFood-obs" name="Consumo de fast food, doces e ultraprocessados - Observação" class="mt-4 hidden-group rounded-lg" placeholder="Qual tipo de alimento você consome?"></textarea>
                </div>

                <p class="motivational-phrase">Se alimentar bem é uma forma de autocuidado que te dá energia para brilhar.</p>

                <div class="flex justify-between mt-8 space-x-4">
                    <button id="backButton2" type="button" class="w-1/2 bg-gray-300 text-gray-800 font-bold hover:bg-gray-400">Voltar</button>
                    <button id="nextButton3" type="button" class="w-1/2 button-highlight">Próximo</button>
                </div>
            </div>

            <!-- Etapa 4: Revisão e Confirmação (Será a nova Etapa 3) -->
            <div id="step4" class="hidden-group">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">Revisão e Confirmação</h2>
                
                <hr class="my-6">
                
                <div class="review-data space-y-4">
                    <!-- Conteúdo será gerado dinamicamente via JavaScript -->
                </div>
                
                <p class="motivational-phrase">Seu corpo é capaz de tudo, é sua mente que você precisa convencer.</p>

                <!-- Este botão fará o submit POST padrão para o Formspree -->
                <div class="flex justify-between mt-8 space-x-4">
                    <button id="backButton3" type="button" class="w-1/2 bg-gray-300 text-gray-800 font-bold hover:bg-gray-400">Voltar</button>
                    <button id="submitButton" type="submit" class="w-1/2 button-highlight">Enviar Formulário</button>
                </div>
            </div>
            
        </form>
    </div>

    <!-- Custom Message Box -->
    <div id="custom-message-box" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
            <h3 id="message-title" class="text-xl font-bold mb-4"></h3>
            <p id="message-content" class="text-gray-700 mb-6"></p>
            <div class="flex justify-end">
                <button id="message-ok-button" class="px-4 py-2 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition">OK</button>
            </div>
        </div>
    </div>

    <script>
        /**
         * Lógica para mostrar/esconder campos extras da anamnese e nutricional (campos condicionais).
         */
        function setupConditionalFields() {
            const conditionalFields = {
                'cirurgia': 'cirurgia-obs', 'coluna': 'coluna-obs', 'articulacoes': 'articulacoes-obs',
                'lesao': 'lesao-obs', 'restricaoMedica': 'restricaoMedica-obs', 'fuma': 'fuma-frequencia',
                'alcool': 'alcool-frequencia', 'atividadeFisica': 'atividadeFisica-obs',
                'medicacao': 'medicacao-obs', 'doencaCronica': 'doencaCronica-obs',
                'alergiaAlimentar': 'alergiaAlimentar-obs', 'pulaRefeicao': 'pulaRefeicao-obs',
                'frutasVegetais': 'frutasVegetais-obs', 'consumoFastFood': 'consumoFastFood-obs'
            };
            
            for (const name in conditionalFields) {
                const radios = document.querySelectorAll(`input[name="${name}"]`);
                const targetElement = document.getElementById(conditionalFields[name]);
    
                if (radios && targetElement) {
                    radios.forEach(radio => {
                        radio.addEventListener('change', (event) => {
                            const shouldShow = event.target.value === 'Sim' || event.target.value === 'Muito Frequente' || event.target.value === 'Ocasional';
                            
                            if (shouldShow) {
                                targetElement.classList.remove('hidden-group');
                                // Já que novalidate está em uso, vamos reativar required aqui
                                if (targetElement.tagName === 'TEXTAREA' || targetElement.tagName === 'INPUT') {
                                    targetElement.setAttribute('required', '');
                                } else {
                                    targetElement.querySelectorAll('input').forEach(input => input.setAttribute('required', ''));
                                }
                            } else {
                                targetElement.classList.add('hidden-group');
                                // Remover required e limpar campo quando não é relevante
                                if (targetElement.tagName === 'TEXTAREA' || targetElement.tagName === 'INPUT') {
                                    targetElement.removeAttribute('required');
                                    targetElement.value = '';
                                } else {
                                    targetElement.querySelectorAll('input').forEach(input => {
                                        input.removeAttribute('required');
                                        input.checked = false;
                                    });
                                }
                            }
                        });
                    });
                }
            }
        }
        
        // Removemos toggleRequired, pois a validação agora é 100% programática
        
        document.addEventListener('DOMContentLoaded', () => {
            // Seletores de Elementos DOM
            const form = document.getElementById('multiStepForm');
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3'); 
            const step4 = document.getElementById('step4'); 
            const nextButton1 = document.getElementById('nextButton1');
            const nextButton2 = document.getElementById('nextButton2');
            const nextButton3 = document.getElementById('nextButton3');
            const backButton1 = document.getElementById('backButton1');
            const backButton2 = document.getElementById('backButton2');
            const backButton3 = document.getElementById('backButton3');
            const dataNascimentoInput = document.getElementById('dataNascimento');
            const idadeInput = document.getElementById('idade');
            const cepInput = document.getElementById('cep');
            
            // CAMPOS MANTIDOS: Data de Início e Planejamento Alimentar
            const dataInicioInput = document.getElementById('dataInicio');
            const planejamentoAlimentarRadios = document.querySelectorAll('input[name="Planejamento Alimentar"]');
            
            const planDetailsDisplay = document.getElementById('planDetailsDisplay');
            const planoRadios = document.querySelectorAll('input[name="Plano Escolhido"]');
            const frequenciaContainer = document.getElementById('frequenciaContainer');
            const frequenciaSelect = document.getElementById('frequenciaSemana');
            const reviewDataContainer = document.querySelector('.review-data');
            const submitButton = document.getElementById('submitButton'); 
            
            // Variáveis de preço e pagamento removidas, mas mantendo a estrutura de dados para as descrições
            const planData = {
                "Trimestral Individual": { description: "Plano 3 meses – treino presencial\nHorário exclusivo\nTreinos via app com vídeos ilustrativos e/ou PDF\nDuas avaliações físicas\nSuporte Online" },
                "Trimestral Compartilhado": { description: "Plano 3 meses – treino presencial\nDependendo da demanda do personal, horário poderá ser compartilhado com outro aluno.\nTreinos via app com vídeos ilustrativos e/ou PDF\nDuas avaliações físicas\nSuporte Online" },
                "Semestral Individual": { description: "Plano 6 meses – treino presencial\nHorário exclusivo\nTreinos via app com vídeos ilustrativos e/ou PDF\nDuas avaliações físicas\nSuporte Online" },
                "Semestral Compartilhado": { description: "Plano 6 meses – treino presencial\nDependendo da demanda do personal, horário poderá ser compartilhado com outro aluno.\nTreinos via app com vídeos ilustrativos e/ou PDF\nDuas avaliações físicas\nSuporte Online" },
                "Trimestral Casal": { description: "Plano 3 meses – treino presencial\nAtendimento deverá ser executado no mesmo horário.\nTreinos via app com vídeos ilustrativos e/ou PDF\nDuas avaliações físicas\nSuporte Online\nObservação: Treinos no mesmo horário" },
                "Semestral Casal": { description: "Plano 6 meses – treino presencial\nAtendimento deverá ser executado no mesmo horário.\nTreinos via app com vídeos ilustrativos e/ou PDF\nDuas avaliações físicas\nSuporte Online\nObservação: Treinos no mesmo horário" },
                "Online": { description: "Plano totalmente online\n1 Treino presencial - mês\nAvaliação física Mensal\nApp para treino com exemplos de execução dos exercícios\nTreinos em PDF\nSuporte online 7 dias semana" }
            };
            
            // Calcula a idade com base na data de nascimento
            function calculateAge() {
                const birthDate = new Date(dataNascimentoInput.value);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDifference = today.getMonth() - birthDate.getMonth();
                if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                idadeInput.value = age > 0 ? `${age} anos` : '';
            }
            
            // Apenas atualiza a descrição do plano
            function updatePlanDetails(selectedPlanoValue) {
                const planoDetalhes = planData[selectedPlanoValue];
                if (!planoDetalhes) {
                    planDetailsDisplay.classList.add('hidden-group');
                    return;
                }
                
                let detailsHtml = '';
                detailsHtml += `<strong>Detalhes do Plano:</strong><ul>`;
                const descriptionLines = planoDetalhes.description.split('\n');
                descriptionLines.forEach(line => {
                    detailsHtml += `<li>${line}</li>`;
                });
                detailsHtml += `</ul>`;
                planDetailsDisplay.innerHTML = detailsHtml;
                planDetailsDisplay.classList.remove('hidden-group');
            }

            // A função de mostrar mensagem foi mantida
            function showMessage(message, type = 'info') {
                const messageBox = document.getElementById('custom-message-box');
                const messageTitle = document.getElementById('message-title');
                const messageContent = document.getElementById('message-content');
                const okButton = document.getElementById('message-ok-button');
                
                messageContent.innerHTML = message;
                messageBox.classList.remove('hidden');
                
                messageTitle.innerText = type === 'error' ? 'Erro!' : (type === 'success' ? 'Sucesso!' : 'Informação');
                messageTitle.classList.remove('text-red-600', 'text-blue-600', 'text-green-600');
                messageTitle.classList.add(type === 'error' ? 'text-red-600' : (type === 'success' ? 'text-green-600' : 'text-blue-600'));
                
                okButton.onclick = () => {
                    messageBox.classList.add('hidden');
                };
            }

            // Popula a página de revisão (removendo as referências a valores/pagamento)
            function populateReviewPage() {
                const form = document.getElementById('multiStepForm');
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                
                reviewDataContainer.innerHTML = '';
        
                const boxes = {
                    'Informações Pessoais e do Plano': ['Nome Completo', 'CPF', 'Data de Nascimento', 'Idade', 'Altura', 'Peso', 'Genero', 'Profissão', 'Telefone de Contato', 'Contato de Emergência', 'CEP', 'Rua', 'Número da Casa', 'Bairro', 'Cidade', 'E-mail', 'Instagram', 'Data de Início', 'Planejamento Alimentar', 'Plano Escolhido', 'Frequência Semanal'], 
                    'Informações de Anamnese': ['Cirurgia Observação', 'Coluna Observação', 'Articulações Observação', 'Lesão Observação', 'Restrição Médica Observação', 'fuma', 'fuma-frequencia', 'alcool', 'alcool-frequencia', 'atividadeFisica', 'Atividade Física Observação', 'nivelMusculacao', 'personalTrainer', 'qualidadeSono', 'Horas de Sono', 'objetivo', 'resultadoEsperado', 'informacoesAdicionais'],
                    'Informações Nutricionais': ['Medicação contínua - Observação', 'Doença Crônica - Observação', 'Alergia Alimentar - Observação', 'Alimentos que mais gosta', 'Alimentos que NÃO gosta', 'Pula Refeição - Observação', 'Frutas e Vegetais - Observação', 'Quantidade de Água', 'Consumo de fast food, doces e ultraprocessados - Observação']
                };

                for (const key in data) {
                    if (key.endsWith('Observação') && data[key].toLowerCase() === 'não') {
                        delete data[key];
                    }
                }
        
                for (const title in boxes) {
                    let html = '';
                    boxes[title].forEach(key => {
                        let value;
                        if (key === 'objetivo') {
                            value = formData.getAll('objetivo').join(', ');
                        } else {
                            // Correção para mapear dados corretamente a partir de formData
                            value = data[key];
                        }
                        
                        // Garante que campos de plano/valor removidos na Etapa 1 não apareçam na Revisão
                        if (value && value.trim() !== '' && value !== 'Não Aplicável - Valores Removidos' && value !== 'Não Aplicável - Sem Valores') {
                            // Mapeamento de chaves
                            const friendlyKey = key
                                .replace(/([A-Z])/g, ' $1') 
                                .replace(/E-mail/, 'E-mail')
                                .replace(/CPF/, 'CPF')
                                .replace(/Observação/, '')
                                .trim();
                            
                            html += `<p><strong>${friendlyKey}:</strong> ${value}</p>`;
                        }
                    });
        
                    if (html !== '') {
                        const box = document.createElement('div');
                        box.className = 'review-box';
                        box.innerHTML = `<div class="section-title">${title}</div><hr class="mb-4">${html}`;
                        reviewDataContainer.appendChild(box);
                    }
                }
            }

            // Lógica para navegação entre etapas (AGORA SEM VALIDACÃO NATIVA)
            function handleNextStep(stepId, nextStepId, isConditional = false, condition) {
                const step = document.getElementById(stepId);
                // Usamos querySelectorAll e a nossa própria lógica de validação.
                const requiredFields = step.querySelectorAll('[required]:not(.hidden-group input, .hidden-group textarea, .hidden-group select)');
                let missingFields = [];
        
                requiredFields.forEach(field => {
                    if (field.type === 'radio' && !document.querySelector(`input[name="${field.name}"]:checked`)) {
                         if (!missingFields.includes(field.name)) { missingFields.push(field.name); }
                    } else if (field.value.trim() === '') {
                        missingFields.push(field.id || field.name);
                    }
                });
        
                if (missingFields.length > 0) {
                    const friendlyNames = {
                        'nomeCompleto': 'Nome Completo', 'cpf': 'CPF', 'dataNascimento': 'Data de Nascimento', 'altura': 'Altura', 'peso': 'Peso', 'Genero': 'Gênero', 'profissao': 'Profissão', 'telefoneContato': 'Telefone de Contato', 'contatoEmergencia': 'Contato de Emergência', 'rua': 'Rua', 'numeroCasa': 'Número da Casa', 'bairro': 'Bairro', 'cidade': 'Cidade', 'email': 'E-mail', 'Plano Escolhido': 'Plano Escolhido', 'frequenciaSemanal': 'Frequência Semanal', 'dataInicio': 'Data de Início', 'Planejamento Alimentar': 'Planejamento Alimentar', 'cirurgia': 'Cirurgia', 'coluna': 'Problemas de Coluna', 'articulacoes': 'Problemas nas Articulações', 'lesao': 'Lesão Grave', 'restricaoMedica': 'Restrição Médica', 'fuma': 'Fuma', 'fuma-frequencia': 'Frequência do Hábito de Fumar', 'alcool': 'Ingere Álcool', 'alcool-frequencia': 'Frequência do Álcool', 'atividadeFisica': 'Atividade Física', 'atividadeFisica-obs': 'Detalhes da Atividade Física', 'nivelMusculacao': 'Nível Musculação', 'personalTrainer': 'Personal Trainer', 'qualidadeSono': 'Qualidade do Sono', 'horasSono': 'Horas de Sono', 'objetivo': 'Objetivo (Mín. 1)', 'medicacao': 'Medicação', 'doencaCronica': 'Doença Crônica', 'alergiaAlimentar': 'Alergia Alimentar', 'pulaRefeicao': 'Pula Refeição', 'frutasVegetais': 'Frutas e Vegetais', 'quantidadeAgua': 'Quantidade de Água', 'consumoFastFood': 'Consumo de Fast Food'
                    };
                    const formattedMissing = missingFields.map(field => friendlyNames[field] || field).join(', ');
                    showMessage(`Por favor, preencha/selecione os seguintes campos obrigatórios: ${formattedMissing}`, 'error');
                    return;
                }
        
                // Lógica CONDICIONAL de avanço
                step.classList.add('hidden-group');
                
                if (isConditional) {
                    // Se for a Etapa 2 e houver condição (Planejamento Alimentar Sim)
                    if (condition) {
                        document.getElementById(nextStepId).classList.remove('hidden-group');
                    } else {
                        // Se for 'Não', pula direto para a Revisão (step4)
                        document.getElementById('step4').classList.remove('hidden-group');
                        populateReviewPage();
                    }
                } else {
                    // Avanço normal (Etapa 1 -> Etapa 2 ou Etapa 3 -> Etapa 4)
                    document.getElementById(nextStepId).classList.remove('hidden-group');

                    if (stepId === 'step3') {
                        populateReviewPage();
                    }
                }
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        
            // Listeners de navegação
            nextButton1.addEventListener('click', () => {
                const selectedPlano = document.querySelector('input[name="Plano Escolhido"]:checked');
                const isOnline = selectedPlano && (selectedPlano.value === "Online"); 
                
                // Configura a obrigatoriedade do campo de frequência dinamicamente
                if (isOnline) {
                    frequenciaSelect.removeAttribute('required');
                } else {
                    frequenciaSelect.setAttribute('required', '');
                }
                
                handleNextStep('step1', 'step2');
            });
        
            nextButton2.addEventListener('click', () => {
                const planejamentoAlimentar = document.querySelector('input[name="Planejamento Alimentar"]:checked').value;
                // Vai para a Etapa 3 (Nutricional) SE Planejamento Alimentar for 'Sim'. Senão, vai para a Revisão.
                handleNextStep('step2', 'step3', true, planejamentoAlimentar === 'Sim');
            });
        
            nextButton3.addEventListener('click', () => {
                // Vai para a Etapa 4 (Revisão)
                handleNextStep('step3', 'step4');
            });
        
            // Botões de voltar
            backButton1.addEventListener('click', () => {
                step2.classList.add('hidden-group');
                step1.classList.remove('hidden-group');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            
            backButton2.addEventListener('click', () => {
                step3.classList.add('hidden-group');
                step2.classList.remove('hidden-group');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        
            backButton3.addEventListener('click', () => {
                const planejamentoAlimentar = document.querySelector('input[name="Planejamento Alimentar"]:checked').value;
                step4.classList.add('hidden-group');
                
                // Volta para a etapa correta (3 ou 2)
                if (planejamentoAlimentar === "Sim") {
                    step3.classList.remove('hidden-group');
                } else {
                    step2.classList.remove('hidden-group');
                }
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // Listeners de atualização para cálculos e visibilidade
            dataNascimentoInput.addEventListener('change', calculateAge);
            
            planejamentoAlimentarRadios.forEach(radio => radio.addEventListener('change', () => {
                const selectedPlano = document.querySelector('input[name="Plano Escolhido"]:checked');
                if (selectedPlano) {
                    updatePlanDetails(selectedPlano.value);
                }
            }));
            
            planoRadios.forEach(radio => radio.addEventListener('change', () => {
                updatePlanDetails(radio.value);
        
                // Esconde ou mostra o campo de frequência
                const isOnline = radio.value === "Online";
                if (isOnline) {
                    frequenciaContainer.classList.add('hidden-group');
                } else {
                    frequenciaContainer.classList.remove('hidden-group');
                }
            }));
            
            // Autocompletar endereço com ViaCEP
            cepInput.addEventListener('blur', () => {
                const cep = cepInput.value.replace(/\D/g, '');
                if (cep.length === 8) {
                    fetch(`https://viacep.com.br/ws/${cep}/json/`)
                        .then(response => response.json())
                        .then(data => {
                            if (!("erro" in data)) {
                                document.getElementById('rua').value = data.logradouro;
                                document.getElementById('bairro').value = data.bairro;
                                document.getElementById('cidade').value = data.localidade;
                            } else {
                                showMessage("CEP não encontrado.", 'error');
                            }
                        })
                        .catch(() => {
                            showMessage("Erro ao buscar o CEP.", 'error');
                        });
                }
            });
        
            // Setup inicial dos campos condicionais
            setupConditionalFields();

            // Listener de SUBMISSÃO do Formulário: Garante o envio nativo
            submitButton.addEventListener('click', (event) => {
                // A navegação handleNextStep já tratou de todas as validações, 
                // então deixamos o submit nativo acontecer.
                form.submit();
            });
        });
    </script>
</body>
</html>
